<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Berkeley J-School 2020 Showcase</title>
  </head>
  <body>


    <!-- Showcase projects encrypted -->
    <div id="content" class="container-fluid px-0">
      <script>
      var _payload = "CRatfOYAzoS3kPQ1IK8UHA==|Reo5+AYL14Sod5UElAz7PA==|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".split("|");
      </script>
    </div>



    <div id="lockquestion" class="container-fluid">
      <form id="encryptionform" class="d-flex flex-column align-items-center justify-content-center vh-100 mx-0 my-0">
        <div>
          <div class="row form-group">
            <div class="col-12">
              <h3 class="text-center">
                <label for="unlock" class="display-4">Berkeley J-School Showcase 2020</label>
              </h3>
            </div>
          </div>
          <div class="row form-group col-12 col-sm-8 offset-sm-2">
            <div class="input-group">
              <input type="password" class="form-control" id="unlock" placeholder="please enter password">
              <div class="input-group-append">
                <button id="unlockbutton" type="submit" class="btn btn-default input-group-text">Enter!</button>
                <span class="input-group-text">
                  <input id="remember" type="checkbox" aria-label="Checkbox to remember password"><small class="pl-2">Remember</small>
                </span>
              </div>
            </div>

            <br>
            <div id="alert-warning">
              
            </div>
          </div>
        </div>
      </form>
    </div>






    <!-- Scripts. Remove those not needed -->
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/randomize.js"></script>
    <script type="text/javascript" src="js/bootstrap-4.3.1.bundle.min.js"></script>
    <script type="text/javascript" src="js/slick.min.js"></script>
    <script type="text/javascript" src="js/aes.js"></script>
    <script type="text/javascript" src="js/hmac-sha256.js"></script>
    <script type="text/javascript" src="js/pbkdf2.js"></script>
    <script>


      //set payload variable if it doesn't already exist.
      var _payload = typeof _payload !== typeof undefined ? _payload : ['','',''];


      const decryptPage = {
        iv              : CryptoJS.enc.Base64.parse(_payload[0]),
        salt            : CryptoJS.enc.Base64.parse(_payload[1]),
        hmac            : CryptoJS.enc.Base64.parse(_payload[2]),
        encoded_message : CryptoJS.enc.Base64.parse(_payload[3]),
        message_base64  : _payload[3], //hmac comparison done on base64 string
        key_size        : 256/32,
        iterations      : 1000,
        cookie_name     : "jschoolshowcase",
        expiration      : new Date(new Date().getFullYear(), 7),
        users_key       : "", //needs to be encoded in CryptoJS.enc.Hex.parse()



        getCookieValue: function(){

          //regex extracts cookie value only
          let re = new RegExp(`(?:(?:^|.*;\\s*)${this.cookie_name}\\s*\\=\\s*([^;]*).*$)|^.*$`);
          let cookie = document.cookie.replace(re, "$1");

          if(cookie !== ""){
            this.users_key = cookie;
            return true;
          }
          return false;
        },

        saveCookie: function(){          
          document.cookie = `${this.cookie_name}=` + this.users_key.toString(CryptoJS.enc.Utf8) +'; expires=' + this.expiration.toUTCString() + 'max-age=15552000; path=/';
        },


        covertPasswordToKey: function(password){


          //convert string password to PBKDF2 key. Save as Hexidecimal
          this.users_key = CryptoJS.PBKDF2(
              password, 
              this.salt, 
              { keySize: this.key_size, iterations: this.iterations }).toString();
          
        },

        checkPasswordWithHMAC: function(){

          //HMAC is a hash of the message using a password. 
          //If we use their password and generate a sha256 hash of the message, it should
          //match with the one sent over. 
          let hmac_with_user_provided_password = CryptoJS.HmacSHA256(
              this.message_base64, 
              CryptoJS.enc.Utf8.parse(this.users_key))
              .toString()
              .trim();

          return hmac_with_user_provided_password === this.hmac.toString() ? true : false;
        },

        unlockPage: function(){

          //we use AES decrypt to actually perform the decryption process. 
          let decrypted_message = CryptoJS.AES.decrypt(
              {ciphertext: this.encoded_message},
              CryptoJS.enc.Utf8.parse(this.users_key),
              {iv:this.iv}
            );


          //return decrypted_message.toString(CryptoJS.enc.Utf8).trim(); //return string of message content
          return CryptoJS.enc.Utf8.stringify(decrypted_message);
        }

      };


      //when they click submit button
      $("#encryptionform").on("submit", function(e){ 
        e.preventDefault(); //no real form submit
        kick_things_off();
      });

      if(decryptPage.getCookieValue()){
        kick_things_off();
      }



      function kick_things_off(){
        //first we convert plaintext password to cryptojs object.
        //It will save it in decryptPage.users_key
        if(decryptPage.users_key === ""){
          decryptPage.covertPasswordToKey($("#unlock").val().toString());
        }

        //check if password HMAC matches, if so, password is good.
        if(decryptPage.checkPasswordWithHMAC() === true){

          if($("#remember").is(':checked')){
            decryptPage.saveCookie();
          }


          $("#lockquestion").remove();
          $("#content").html(decryptPage.unlockPage());
          $("#content .slide.vh-100").randomize();
          $('.slick').slick({autoplay:true, autoplaySpeed:10000, accessibility: true, arrows: true});

        } else {

          //remove existing cookie in case it was set
          document.cookie = `${decryptPage.cookie_name}=; expires=Thu, 01 Jan 1970 00:00:01 GMT;`;

          //show alert
          if(!$("#alert-warning .alert").length){
            var $div = $("<div />")
              .addClass("alert alert-warning alert-dismissible mt-3")
              .attr("role", "alert");
            $div.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
            $div.append('<span id="response">The password you entered did not work. Please try again.</span>');
            $div.appendTo("#alert-warning");
          }
        }

      };



    </script>
  </body>
</html>