<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Berkeley J-School 2020 Showcase</title>
  </head>
  <body>


    <!-- Showcase projects encrypted -->
    <div id="content" class="container-fluid px-0">
      <script>
      var _payload = "EKAurnX6s+D+9SyjxsHoQw==|KkmF/QT8e5zsECX4nyQ5/g==|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".split("|");
      </script>
    </div>



    <div id="lockquestion" class="container-fluid">
      <form id="encryptionform" class="d-flex flex-column align-items-center justify-content-center vh-100 mx-0 my-0">
        <div>
          <div class="row form-group">
            <div class="col-12">
              <h3 class="text-center">
                <label for="unlock" class="display-4">Berkeley J-School Showcase 2020</label>
              </h3>
            </div>
          </div>
          <div class="row form-group col-12 col-sm-8 offset-sm-2">
            <div class="input-group">
              <input type="password" class="form-control" id="unlock" placeholder="enter password and press unlock">
              <div class="input-group-append">
                <button id="unlockbutton" type="submit" class="btn btn-default input-group-text">Enter!</button>
                <span class="input-group-text">
                  <input id="remember" type="checkbox" aria-label="Checkbox to remember password"><small class="pl-2">Remember</small>
                </span>
              </div>
            </div>

            <br>
            <div id="alert-warning">
              
            </div>
          </div>
        </div>
      </form>
    </div>






    <!-- Scripts. Remove those not needed -->
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/randomize.js"></script>
    <script type="text/javascript" src="js/bootstrap-4.3.1.bundle.min.js"></script>
    <script type="text/javascript" src="js/slick.min.js"></script>
    <script type="text/javascript" src="js/aes.js"></script>
    <script type="text/javascript" src="js/hmac-sha256.js"></script>
    <script type="text/javascript" src="js/pbkdf2.js"></script>
    <script>


      //set payload variable if it doesn't already exist.
      var _payload = typeof _payload !== typeof undefined ? _payload : ['','',''];


      const decryptPage = {
        iv              : CryptoJS.enc.Base64.parse(_payload[0]),
        salt            : CryptoJS.enc.Base64.parse(_payload[1]),
        hmac            : CryptoJS.enc.Base64.parse(_payload[2]),
        encoded_message : CryptoJS.enc.Base64.parse(_payload[3]),
        message_base64  : _payload[3], //hmac comparison done on base64 string
        key_size        : 256/32,
        iterations      : 1000,
        cookie_name     : "jschoolshowcase",
        expiration      : new Date(new Date().getFullYear(), 7),
        users_key       : "", //needs to be encoded in CryptoJS.enc.Hex.parse()



        getCookieValue: function(){
          //regex extracts cookie value only
          let re = new RegExp(`(?:(?:^|.*;\\s*)${this.cookie_name}\\s*\\=\\s*([^;]*).*$)|^.*$`);
          let cookie = document.cookie.replace(re, "$1");

          if(cookie !== ""){
            this.users_key = cookie;
            return true;
          }
          return false;
        },

        saveCookie: function(){
          document.cookie = `${this.cookie_name}=` + this.users_key.toString(CryptoJS.enc.Utf8) +'; expires=' + this.expiration.toUTCString() + 'max-age=15552000; path=/';
        },


        covertPasswordToKey: function(password){


          //convert string password to PBKDF2 key. Save as Hexidecimal
          this.users_key = CryptoJS.PBKDF2(
              password, 
              this.salt, 
              { keySize: this.key_size, iterations: this.iterations }).toString();
          
        },

        checkPasswordWithHMAC: function(){

          //HMAC is a hash of the message using a password. 
          //If we use their password and generate a sha256 hash of the message, it should
          //match with the one sent over. 
          let hmac_with_user_provided_password = CryptoJS.HmacSHA256(
              this.message_base64, 
              CryptoJS.enc.Utf8.parse(this.users_key))
              .toString()
              .trim();

          return hmac_with_user_provided_password === this.hmac.toString() ? true : false;
        },

        unlockPage: function(){

          //we use AES decrypt to actually perform the decryption process. 
          let decrypted_message = CryptoJS.AES.decrypt(
              {ciphertext: this.encoded_message},
              CryptoJS.enc.Utf8.parse(this.users_key),
              {iv:this.iv}
            );


          //return decrypted_message.toString(CryptoJS.enc.Utf8).trim(); //return string of message content
          return CryptoJS.enc.Utf8.stringify(decrypted_message);
        }

      };


      //when they click submit button
      $("#encryptionform").on("submit", function(e){ 
        e.preventDefault(); //no real form submit
        kick_things_off();
      });

      if(decryptPage.getCookieValue()){
        kick_things_off();
      }



      function kick_things_off(){
        //first we convert plaintext password to cryptojs object.
        //It will save it in decryptPage.users_key
        if(decryptPage.users_key === ""){
          decryptPage.covertPasswordToKey($("#unlock").val().toString());
        }

        //check if password HMAC matches, if so, password is good.
        if(decryptPage.checkPasswordWithHMAC() === true){

          if($("#remember").is(':checked')){
            decryptPage.saveCookie();
          }


          $("#lockquestion").remove();
          $("#content").html(decryptPage.unlockPage());
          $("#content .slide.vh-100").randomize();
          $('.slick').slick({autoplay:true, autoplaySpeed:10000, accessibility: true, arrows: true});

        } else {

          //remove existing cookie in case it was set
          document.cookie = 'jschoolshowcase=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';

          //show alert
          if(!$("#alert-warning .alert").length){
            var $div = $("<div />")
              .addClass("alert alert-warning alert-dismissible mt-3")
              .attr("role", "alert");
            $div.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
            $div.append('<span id="response">The password you entered did not work. Please try again.</span>');
            $div.appendTo("#alert-warning");
          }
        }

      };



    </script>
  </body>
</html>