<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Berkeley J-School 2020 Showcase</title>
  </head>
  <body>


    <!-- Showcase projects encrypted -->
    <div id="content" class="container-fluid px-0">
      <script>
      var _payload = "0WRGjJbtE119gJItZIszlw==|CQNEF4Gv6qtS42JA0LHyFw==|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".split("|");
      </script>
    </div>



    <div id="lockquestion" class="container-fluid">
      <form id="encryptionform" class="d-flex flex-column align-items-center justify-content-center vh-100 mx-0 my-0">
        <div>
          <div class="row form-group">
            <div class="col-12">
              <h3 class="text-center">
                <label for="unlock" class="display-4">Berkeley J-School Showcase 2020</label>
              </h3>
            </div>
          </div>
          <div class="row form-group col-12 col-sm-8 offset-sm-2">
            <div class="input-group">
              <input type="password" class="form-control" id="unlock" placeholder="please enter password">
              <div class="input-group-append">
                <button id="unlockbutton" type="submit" class="btn btn-default input-group-text">Enter!</button>
                <span class="input-group-text">
                  <input id="remember" type="checkbox" aria-label="Checkbox to remember password"><small class="pl-2">Remember</small>
                </span>
              </div>
            </div>

            <br>
            <div id="alert-warning">
              
            </div>
          </div>
        </div>
      </form>
    </div>






    <!-- Scripts. Remove those not needed -->
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/randomize.js"></script>
    <script type="text/javascript" src="js/bootstrap-4.3.1.bundle.min.js"></script>
    <script type="text/javascript" src="js/slick.min.js"></script>
    <script type="text/javascript" src="js/aes.js"></script>
    <script type="text/javascript" src="js/hmac-sha256.js"></script>
    <script type="text/javascript" src="js/pbkdf2.js"></script>
    <script>


      //set payload variable if it doesn't already exist.
      var _payload = typeof _payload !== typeof undefined ? _payload : ['','',''];


      const decryptPage = {
        iv              : CryptoJS.enc.Base64.parse(_payload[0]),
        salt            : CryptoJS.enc.Base64.parse(_payload[1]),
        hmac            : CryptoJS.enc.Base64.parse(_payload[2]),
        encoded_message : CryptoJS.enc.Base64.parse(_payload[3]),
        message_base64  : _payload[3], //hmac comparison done on base64 string
        key_size        : 256/32,
        iterations      : 1000,
        cookie_name     : "jschoolshowcase",
        expiration      : new Date(new Date().getFullYear(), 7),
        users_key       : "", //needs to be encoded in CryptoJS.enc.Hex.parse()



        getCookieValue: function(){
          //regex extracts cookie value only
          let re = new RegExp(`(?:(?:^|.*;\\s*)${this.cookie_name}\\s*\\=\\s*([^;]*).*$)|^.*$`);
          let cookie = document.cookie.replace(re, "$1");

          if(cookie !== ""){
            this.users_key = cookie;
            return true;
          }
          return false;
        },

        saveCookie: function(){
          document.cookie = `${this.cookie_name}=` + this.users_key.toString(CryptoJS.enc.Utf8) +'; expires=' + this.expiration.toUTCString() + 'max-age=15552000; path=/';
        },


        covertPasswordToKey: function(password){


          //convert string password to PBKDF2 key. Save as Hexidecimal
          this.users_key = CryptoJS.PBKDF2(
              password, 
              this.salt, 
              { keySize: this.key_size, iterations: this.iterations }).toString();
          
        },

        checkPasswordWithHMAC: function(){

          //HMAC is a hash of the message using a password. 
          //If we use their password and generate a sha256 hash of the message, it should
          //match with the one sent over. 
          let hmac_with_user_provided_password = CryptoJS.HmacSHA256(
              this.message_base64, 
              CryptoJS.enc.Utf8.parse(this.users_key))
              .toString()
              .trim();

          return hmac_with_user_provided_password === this.hmac.toString() ? true : false;
        },

        unlockPage: function(){

          //we use AES decrypt to actually perform the decryption process. 
          let decrypted_message = CryptoJS.AES.decrypt(
              {ciphertext: this.encoded_message},
              CryptoJS.enc.Utf8.parse(this.users_key),
              {iv:this.iv}
            );


          //return decrypted_message.toString(CryptoJS.enc.Utf8).trim(); //return string of message content
          return CryptoJS.enc.Utf8.stringify(decrypted_message);
        }

      };


      //when they click submit button
      $("#encryptionform").on("submit", function(e){ 
        e.preventDefault(); //no real form submit
        kick_things_off();
      });

      if(decryptPage.getCookieValue()){
        kick_things_off();
      }



      function kick_things_off(){
        //first we convert plaintext password to cryptojs object.
        //It will save it in decryptPage.users_key
        if(decryptPage.users_key === ""){
          decryptPage.covertPasswordToKey($("#unlock").val().toString());
        }

        //check if password HMAC matches, if so, password is good.
        if(decryptPage.checkPasswordWithHMAC() === true){

          if($("#remember").is(':checked')){
            decryptPage.saveCookie();
          }


          $("#lockquestion").remove();
          $("#content").html(decryptPage.unlockPage());
          $("#content .slide.vh-100").randomize();
          $('.slick').slick({autoplay:true, autoplaySpeed:10000, accessibility: true, arrows: true});

        } else {

          //remove existing cookie in case it was set
          document.cookie = 'jschoolshowcase=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';

          //show alert
          if(!$("#alert-warning .alert").length){
            var $div = $("<div />")
              .addClass("alert alert-warning alert-dismissible mt-3")
              .attr("role", "alert");
            $div.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
            $div.append('<span id="response">The password you entered did not work. Please try again.</span>');
            $div.appendTo("#alert-warning");
          }
        }

      };



    </script>
  </body>
</html>