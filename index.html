<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Berkeley J-School 2020 Showcase</title>
  </head>
  <body>


    <!-- Showcase projects encrypted -->
    <div id="content" class="container-fluid px-0">
      <script>
      var _payload = "B6NhtlKSx6VHC5B5vOYlIg==|8Kddcxrim1NwMYRobEyEXw==|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".split("|");
      </script>
    </div>



    <div id="lockquestion" class="container-fluid">
      <form id="encryptionform" class="d-flex flex-column align-items-center justify-content-center vh-100 mx-0 my-0">
        <div>
          <div class="row form-group">
            <div class="col-12">
              <h3 class="text-center">
                <label for="unlock" class="display-4">Berkeley J-School Showcase 2020</label>
              </h3>
            </div>
          </div>
          <div class="row form-group col-12 col-sm-8 offset-sm-2">
            <div class="input-group">
              <input type="password" class="form-control" id="unlock" placeholder="enter password and press unlock">
              <div class="input-group-append">
                <button id="unlockbutton" type="submit" class="btn btn-default input-group-text">Enter!</button>
                <span class="input-group-text">
                  <input id="remember" type="checkbox" aria-label="Checkbox to remember password"><small class="pl-2">Remember</small>
                </span>
              </div>
            </div>

            <br>
            <div id="alert-warning">
              
            </div>
          </div>
        </div>
      </form>
    </div>






    <!-- Scripts. Remove those not needed -->
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/randomize.js"></script>
    <script type="text/javascript" src="js/bootstrap-4.3.1.bundle.min.js"></script>
    <script type="text/javascript" src="js/slick.min.js"></script>
    <script type="text/javascript" src="js/aes.js"></script>
    <script type="text/javascript" src="js/hmac-sha256.js"></script>
    <script type="text/javascript" src="js/pbkdf2.js"></script>
    <script>


      //set payload variable if it doesn't already exist.
      var _payload = typeof _payload !== typeof undefined ? _payload : ['','',''];


      const decryptPage = {
        iv              : CryptoJS.enc.Base64.parse(_payload[0]),
        salt            : CryptoJS.enc.Base64.parse(_payload[1]),
        hmac            : CryptoJS.enc.Base64.parse(_payload[2]),
        encoded_message : CryptoJS.enc.Base64.parse(_payload[3]),
        message_base64  : _payload[3], //hmac comparison done on base64 string
        key_size        : 256/32,
        iterations      : 1000,
        cookie_name     : "jschoolshowcase",
        expiration      : new Date(new Date().getFullYear(), 7),
        users_key       : "", //needs to be encoded in CryptoJS.enc.Hex.parse()



        getCookieValue: function(){
          //regex extracts cookie value only
          let re = new RegExp(`(?:(?:^|.*;\\s*)${this.cookie_name}\\s*\\=\\s*([^;]*).*$)|^.*$`);
          let cookie = document.cookie.replace(re, "$1");

          if(cookie !== ""){
            this.users_key = cookie;
            return true;
          }
          return false;
        },

        saveCookie: function(){
          document.cookie = `${this.cookie_name}=` + this.users_key.toString(CryptoJS.enc.Utf8) +'; expires=' + this.expiration.toUTCString() + 'max-age=15552000; path=/';
        },


        covertPasswordToKey: function(password){


          //convert string password to PBKDF2 key. Save as Hexidecimal
          this.users_key = CryptoJS.PBKDF2(
              password, 
              this.salt, 
              { keySize: this.key_size, iterations: this.iterations }).toString();
          
        },

        checkPasswordWithHMAC: function(){

          //HMAC is a hash of the message using a password. 
          //If we use their password and generate a sha256 hash of the message, it should
          //match with the one sent over. 
          let hmac_with_user_provided_password = CryptoJS.HmacSHA256(
              this.message_base64, 
              CryptoJS.enc.Utf8.parse(this.users_key))
              .toString()
              .trim();

          return hmac_with_user_provided_password === this.hmac.toString() ? true : false;
        },

        unlockPage: function(){

          //we use AES decrypt to actually perform the decryption process. 
          let decrypted_message = CryptoJS.AES.decrypt(
              {ciphertext: this.encoded_message},
              CryptoJS.enc.Utf8.parse(this.users_key),
              {iv:this.iv}
            );


          //return decrypted_message.toString(CryptoJS.enc.Utf8).trim(); //return string of message content
          return CryptoJS.enc.Utf8.stringify(decrypted_message);
        }

      };


      //when they click submit button
      $("#encryptionform").on("submit", function(e){ 
        e.preventDefault(); //no real form submit
        kick_things_off();
      });

      if(decryptPage.getCookieValue()){
        kick_things_off();
      }



      function kick_things_off(){
        //first we convert plaintext password to cryptojs object.
        //It will save it in decryptPage.users_key
        if(decryptPage.users_key === ""){
          decryptPage.covertPasswordToKey($("#unlock").val().toString());
        }

        //check if password HMAC matches, if so, password is good.
        if(decryptPage.checkPasswordWithHMAC() === true){

          if($("#remember").is(':checked')){
            decryptPage.saveCookie();
          }


          $("#lockquestion").remove();
          $("#content").html(decryptPage.unlockPage());
          $("#content .slide.vh-100").randomize();
          $('.slick').slick({autoplay:true, autoplaySpeed:10000, accessibility: true, arrows: true});

        } else {

          //remove existing cookie in case it was set
          document.cookie = 'jschoolshowcase=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';

          //show alert
          if(!$("#alert-warning .alert").length){
            var $div = $("<div />")
              .addClass("alert alert-warning alert-dismissible mt-3")
              .attr("role", "alert");
            $div.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
            $div.append('<span id="response">The password you entered did not work. Please try again.</span>');
            $div.appendTo("#alert-warning");
          }
        }

      };



    </script>
  </body>
</html>