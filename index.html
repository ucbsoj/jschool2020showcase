<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Berkeley J-School 2020 Showcase</title>
  </head>
  <body>


    <!-- Showcase projects encrypted -->
    <div id="content" class="container-fluid px-0">
      <script>
      var _payload = "zfAjGa9h5zTCmk5EdDrDGg==|fATbl0GAEjIqRGT5iuluBw==|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".split("|");
      </script>
    </div>



    <div id="lockquestion" class="container-fluid">
      <form id="encryptionform" class="d-flex flex-column align-items-center justify-content-center vh-100 mx-0 my-0">
        <div>
          <div class="row form-group">
            <div class="col-12">
              <h3 class="text-center">
                <label for="unlock" class="display-4">Berkeley J-School Showcase 2020</label>
              </h3>
            </div>
          </div>
          <div class="row form-group col-12 col-sm-8 offset-sm-2">
            <div class="input-group">
              <input type="password" class="form-control" id="unlock" placeholder="enter password and press unlock">
              <div class="input-group-append">
                <button id="unlockbutton" type="submit" class="btn btn-default input-group-text">Enter!</button>
                <span class="input-group-text">
                  <input id="remember" type="checkbox" aria-label="Checkbox to remember password"><small class="pl-2">Remember</small>
                </span>
              </div>
            </div>

            <br>
            <div id="alert-warning">
              
            </div>
          </div>
        </div>
      </form>
    </div>






    <!-- Scripts. Remove those not needed -->
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/randomize.js"></script>
    <script type="text/javascript" src="js/bootstrap-4.3.1.bundle.min.js"></script>
    <script type="text/javascript" src="js/slick.min.js"></script>
    <script type="text/javascript" src="js/aes.js"></script>
    <script type="text/javascript" src="js/hmac-sha256.js"></script>
    <script type="text/javascript" src="js/pbkdf2.js"></script>
    <script>


      //set payload variable if it doesn't already exist.
      var _payload = typeof _payload !== typeof undefined ? _payload : ['','',''];


      const decryptPage = {
        iv              : CryptoJS.enc.Base64.parse(_payload[0]),
        salt            : CryptoJS.enc.Base64.parse(_payload[1]),
        hmac            : CryptoJS.enc.Base64.parse(_payload[2]),
        encoded_message : CryptoJS.enc.Base64.parse(_payload[3]),
        message_base64  : _payload[3], //hmac comparison done on base64 string
        key_size        : 256/32,
        iterations      : 1000,
        cookie_name     : "jschoolshowcase",
        expiration      : new Date(new Date().getFullYear(), 7),
        users_key       : "", //needs to be encoded in CryptoJS.enc.Hex.parse()



        getCookieValue: function(){
          //regex extracts cookie value only
          let re = new RegExp(`(?:(?:^|.*;\\s*)${this.cookie_name}\\s*\\=\\s*([^;]*).*$)|^.*$`);
          let cookie = document.cookie.replace(re, "$1");

          if(cookie !== ""){
            this.users_key = cookie;
            return true;
          }
          return false;
        },

        saveCookie: function(){
          document.cookie = `${this.cookie_name}=` + this.users_key.toString(CryptoJS.enc.Utf8) +'; expires=' + this.expiration.toUTCString() + 'max-age=15552000; path=/';
        },


        covertPasswordToKey: function(password){


          //convert string password to PBKDF2 key. Save as Hexidecimal
          this.users_key = CryptoJS.PBKDF2(
              password, 
              this.salt, 
              { keySize: this.key_size, iterations: this.iterations }).toString();
          
        },

        checkPasswordWithHMAC: function(){

          //HMAC is a hash of the message using a password. 
          //If we use their password and generate a sha256 hash of the message, it should
          //match with the one sent over. 
          let hmac_with_user_provided_password = CryptoJS.HmacSHA256(
              this.message_base64, 
              CryptoJS.enc.Utf8.parse(this.users_key))
              .toString()
              .trim();

          return hmac_with_user_provided_password === this.hmac.toString() ? true : false;
        },

        unlockPage: function(){

          //we use AES decrypt to actually perform the decryption process. 
          let decrypted_message = CryptoJS.AES.decrypt(
              {ciphertext: this.encoded_message},
              CryptoJS.enc.Utf8.parse(this.users_key),
              {iv:this.iv}
            );


          //return decrypted_message.toString(CryptoJS.enc.Utf8).trim(); //return string of message content
          return CryptoJS.enc.Utf8.stringify(decrypted_message);
        }

      };


      //when they click submit button
      $("#encryptionform").on("submit", function(e){ 
        e.preventDefault(); //no real form submit
        kick_things_off();
      });

      if(decryptPage.getCookieValue()){
        kick_things_off();
      }



      function kick_things_off(){
        //first we convert plaintext password to cryptojs object.
        //It will save it in decryptPage.users_key
        if(decryptPage.users_key === ""){
          decryptPage.covertPasswordToKey($("#unlock").val().toString());
        }

        //check if password HMAC matches, if so, password is good.
        if(decryptPage.checkPasswordWithHMAC() === true){

          if($("#remember").is(':checked')){
            decryptPage.saveCookie();
          }


          $("#lockquestion").remove();
          $("#content").html(decryptPage.unlockPage());
          $("#content .slide.vh-100").randomize();
          $('.slick').slick({autoplay:true, autoplaySpeed:10000, accessibility: true, arrows: true});

        } else {

          //remove existing cookie in case it was set
          document.cookie = 'jschoolshowcase=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';

          //show alert
          if(!$("#alert-warning .alert").length){
            var $div = $("<div />")
              .addClass("alert alert-warning alert-dismissible mt-3")
              .attr("role", "alert");
            $div.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
            $div.append('<span id="response">The password you entered did not work. Please try again.</span>');
            $div.appendTo("#alert-warning");
          }
        }

      };



    </script>
  </body>
</html>