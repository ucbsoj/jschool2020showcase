<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Berkeley J-School 2020 Showcase</title>
  </head>
  <body>


    <!-- Showcase projects encrypted -->
    <div id="content" class="container-fluid px-0">
      <script>
      var _payload = "v+VOUyUdoQxtYGlogphroA==|5dWjddG3byOmIZrR1WLsJg==|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".split("|");
      </script>
    </div>



    <div id="lockquestion" class="container-fluid">
      <form id="encryptionform" class="d-flex flex-column align-items-center justify-content-center vh-100 mx-0 my-0">
        <div>
          <div class="row form-group">
            <div class="col-12">
              <h3 class="text-center">
                <label for="unlock" class="display-4">Berkeley J-School Showcase 2020</label>
              </h3>
            </div>
          </div>
          <div class="row form-group col-12 col-sm-8 offset-sm-2">
            <div class="input-group">
              <input type="password" class="form-control" id="unlock" placeholder="please enter password">
              <div class="input-group-append">
                <button id="unlockbutton" type="submit" class="btn btn-default input-group-text">Enter!</button>
                <span class="input-group-text">
                  <input id="remember" type="checkbox" aria-label="Checkbox to remember password"><small class="pl-2">Remember</small>
                </span>
              </div>
            </div>

            <br>
            <div id="alert-warning">
              
            </div>
          </div>
        </div>
      </form>
    </div>






    <!-- Scripts. Remove those not needed -->
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/randomize.js"></script>
    <script type="text/javascript" src="js/bootstrap-4.3.1.bundle.min.js"></script>
    <script type="text/javascript" src="js/slick.min.js"></script>
    <script type="text/javascript" src="js/aes.js"></script>
    <script type="text/javascript" src="js/hmac-sha256.js"></script>
    <script type="text/javascript" src="js/pbkdf2.js"></script>
    <script>


      //set payload variable if it doesn't already exist.
      var _payload = typeof _payload !== typeof undefined ? _payload : ['','',''];


      const decryptPage = {
        iv              : CryptoJS.enc.Base64.parse(_payload[0]),
        salt            : CryptoJS.enc.Base64.parse(_payload[1]),
        hmac            : CryptoJS.enc.Base64.parse(_payload[2]),
        encoded_message : CryptoJS.enc.Base64.parse(_payload[3]),
        message_base64  : _payload[3], //hmac comparison done on base64 string
        key_size        : 256/32,
        iterations      : 1000,
        cookie_name     : "jschoolshowcase",
        expiration      : new Date(new Date().getFullYear(), 7),
        users_key       : "", //needs to be encoded in CryptoJS.enc.Hex.parse()



        getCookieValue: function(){

          //regex extracts cookie value only
          let re = new RegExp(`(?:(?:^|.*;\\s*)${this.cookie_name}\\s*\\=\\s*([^;]*).*$)|^.*$`);
          let cookie = document.cookie.replace(re, "$1");

          if(cookie !== ""){
            this.users_key = cookie;
            return true;
          }
          return false;
        },

        saveCookie: function(){          
          document.cookie = `${this.cookie_name}=` + this.users_key.toString(CryptoJS.enc.Utf8) +'; expires=' + this.expiration.toUTCString() + 'max-age=15552000; path=/';
        },


        covertPasswordToKey: function(password){


          //convert string password to PBKDF2 key. Save as Hexidecimal
          this.users_key = CryptoJS.PBKDF2(
              password, 
              this.salt, 
              { keySize: this.key_size, iterations: this.iterations }).toString();
          
        },

        checkPasswordWithHMAC: function(){

          //HMAC is a hash of the message using a password. 
          //If we use their password and generate a sha256 hash of the message, it should
          //match with the one sent over. 
          let hmac_with_user_provided_password = CryptoJS.HmacSHA256(
              this.message_base64, 
              CryptoJS.enc.Utf8.parse(this.users_key))
              .toString()
              .trim();

          return hmac_with_user_provided_password === this.hmac.toString() ? true : false;
        },

        unlockPage: function(){

          //we use AES decrypt to actually perform the decryption process. 
          let decrypted_message = CryptoJS.AES.decrypt(
              {ciphertext: this.encoded_message},
              CryptoJS.enc.Utf8.parse(this.users_key),
              {iv:this.iv}
            );


          //return decrypted_message.toString(CryptoJS.enc.Utf8).trim(); //return string of message content
          return CryptoJS.enc.Utf8.stringify(decrypted_message);
        }

      };


      //when they click submit button
      $("#encryptionform").on("submit", function(e){ 
        e.preventDefault(); //no real form submit
        kick_things_off();
      });

      if(decryptPage.getCookieValue()){
        kick_things_off();
      }



      function kick_things_off(){
        //first we convert plaintext password to cryptojs object.
        //It will save it in decryptPage.users_key
        if(decryptPage.users_key === ""){
          decryptPage.covertPasswordToKey($("#unlock").val().toString());
        }

        //check if password HMAC matches, if so, password is good.
        if(decryptPage.checkPasswordWithHMAC() === true){

          if($("#remember").is(':checked')){
            decryptPage.saveCookie();
          }


          $("#lockquestion").remove();
          $("#content").html(decryptPage.unlockPage());
          $("#content .slide.vh-100").randomize();
          $('.slick').slick({autoplay:true, autoplaySpeed:10000, accessibility: true, arrows: true});

        } else {

          //remove existing cookie in case it was set
          document.cookie = `${decryptPage.cookie_name}=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/`;

          //show alert
          if(!$("#alert-warning .alert").length){
            var $div = $("<div />")
              .addClass("alert alert-warning alert-dismissible mt-3")
              .attr("role", "alert");
            $div.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
            $div.append('<span id="response">The password you entered did not work. Please try again.</span>');
            $div.appendTo("#alert-warning");
          }
        }

      };



    </script>
  </body>
</html>